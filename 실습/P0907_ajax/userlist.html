<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
    <title>Document</title>
    <script>
      //arrow function에 this가 안되는 이유. 애로우 펑션이 디스를 가지고있지않아서 상위스코프를 따라간다
      //arrow function에 일부러 this의 바인딩을 상위 스코프의 this를 쓰기위해서 일부러 this를 쓸 때가많다.
      //항상 this는 어떤 대상을 호출했는지에 따라 달라진다했지?
      window.onload = function () {
        function getUserList() {
          fetch("https://jsonplaceholder.typicode.com/users")
            .then((response) => response.json()) //arrow function은 내 상위 스코프를 this를 가져다 쓰고싶을때만 쓰는것임
            .then((json) => displayUserList(json))
            .catch((error) => console.log(error));
        }
        function displayUserList(userList) {
          let userListBody = document.querySelector("#userList");
          userListBody.innerHTML = "";
          //<tr><td></td></tr>
          for (const user of userList) {
            let tr = document.createElement("tr");
            let content = "";
            tr.setAttribute("data-userid", user.id);
            tr.addEventListener("click", getPosts);
            content = `<td>${user.id}</td>`;
            content += `<td>${user.name}</td>`;
            content += `<td>${user.phone}</td>`;
            content += `<td>${user.website}</td>`;
            tr.innerHTML = content;
            userListBody.appendChild(tr);
          }
        }
        function getPosts() {
          let userId = this.getAttribute("data-userid"); //이벤트핸들러에서 소스는 이벤트핸들러 자기 자신이잖아요
          fetch(`https://jsonplaceholder.typicode.com/users/${userId}/posts`)
            .then((response) => response.json()) //arrow function은 내 상위 스코프를 this를 가져다 쓰고싶을때만 쓰는것임
            .then((json) => displayPostList(json))
            .catch((error) => console.log(error));
        }
        function displayPostList(posts) {
          let postListBody = document.querySelector("#postList");

          postListBody.innerHTML = "";
          for (const post of posts) {
            //하나씩 꺼내서 tr, td만들어야함
            let tr = document.createElement("tr");
            let content = `<td>${post.userId}</td>`;
            content += `<td>${post.title}</td>`;
            content += `<td>${post.body}</td>`;
            tr.innerHTML = content;
            postListBody.appendChild(tr);
          }
        }
        document.querySelector("#listBtn").addEventListener("click", getUserList);
      };
    </script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <button id="listBtn" class="btn btn-primary">사용자 정보 불러오기</button>
      </div>
      <div class="row">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>아이디</th>
              <th>이름</th>
              <th>전화번호</th>
              <th>사이트</th>
            </tr>
          </thead>
          <tbody id="userList">
            <tr>
              <td class="text-center" colspan="4">사용자 정보를 조회해주세요</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="row">
        <table class="table">
          <thead>
            <tr>
              <th class="col-md-2">작성자아이디</th>
              <th class="col-md-4">제목</th>
              <th class="col-md-6">내용</th>
            </tr>
          </thead>
          <tbody id="postList"></tbody>
        </table>
      </div>
    </div>
  </body>
</html>
